@page "/Add"
@using Microsoft.AspNetCore.Components
@using VideoOverflow.Core.DTOs
@using System.ComponentModel.DataAnnotations
@inject HttpClient _http
@inject NavigationManager _navigationManager

<h1>Create Resource</h1>

<hr />

<MudForm Model="_createForm">
    <MudTextField T="string" Label="Site Title" @bind-Value="_createForm.SiteTitle"/>
    <MudTextField T="string" Label="Site Url" @bind-Value="_createForm.SiteUrl"/>
    <MudTextField T="string" Label="MaterialType" @bind-Value="_createForm.MaterialType"/>
    <MudTextField T="string" Label="Author" @bind-Value="_createForm.Author"/>
    <MudTextField T="string" Label="LixNumber" @bind-Value="_createForm.LixNumber"/>
    <MudTextField T="string" Label="Language" @bind-Value="_createForm.Language"/>
    <MudTextField T="string" Label="Tags" @bind-Value="_createForm.Tags"/>
    <MudTextField T="string" Label="Powers" @bind-Value="_createForm.Powers"/>
    <MudTextField T="string" Label="Created" @bind-Value="_createForm.Created"/>
</MudForm>
<MudButton Variant="Variant.Filled" Color="Color.Primary" Class="ml-auto" OnClick="@(async () => await HandleValidSubmit())">Submit</MudButton>


@code {
    private CreateForm _createForm = new();
    private string _categories;

    private async Task HandleValidSubmit()
    {
        var payload = new ResourceCreateDTO()
        {
            Created = DateTime.Parse(_createForm.Created),
            MaterialType = VideoOverflow.Core.ResourceType.Article,
            SiteUrl = _createForm.SiteUrl,
            SiteTitle = _createForm.SiteTitle,
            Author = _createForm.Author,
            LixNumber = Int32.Parse(_createForm.LixNumber),
            Language = _createForm.Language
        };


        var response = await _http.PostAsJsonAsync("api/resources", payload);

        if (response.IsSuccessStatusCode)
        {
            var created = await response.Content.ReadFromJsonAsync<ResourceDTO>();

            var uri = $"{_navigationManager.BaseUri}resource/{created?.Id}";

            _navigationManager.NavigateTo(uri);
        }
    }

    private void Cancel()
    {
        var uri = $"{_navigationManager.BaseUri}resources";

        _navigationManager.NavigateTo(uri);
    }

    private class CreateForm
    {
        [Required]
        public string SiteTitle { get; set; }
        [Required]
        public string SiteUrl { get; set; }
        [Required]
        public string MaterialType { get; set; }
        [Required]
        public string Author { get; set; }
        [Required]
        public string LixNumber { get; set; }
        [Required]
        public string Language { get; set; }
        [Required]
        public string Tags { get; set; }
        [Required]
        public string Powers { get; set; }
        [Required]
        public string Created { get; set; }
    }

}
